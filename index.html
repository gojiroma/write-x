<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¹</text></svg>" />
    <title>mogr</title>
    <style>
        body {
            font-family: 'Yu Mincho', 'Hiragino Mincho Pro', serif;
            background-color: #f5f5dc;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
            margin: 0;
            position: relative;
        }

        .side-buttons {
            position: fixed;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 30;
        }

        .side-button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background-color: #fff8dc;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: background-color 0.2s;
        }

        .side-button:hover {
            background-color: #e8e8c8;
        }

        .input-container {
            width: 80%;
            max-width: 600px;
            margin-bottom: 10px;
        }

        .title-input {
            outline: none;
            text-align: center;
            width: 100%;
            padding: 12px;
            font-size: 24px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fff8dc;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .content-textarea-wrapper {
            width: 80%;
            max-width: 600px;
            margin-bottom: 20px;
            position: relative;
        }

        .content-textarea {
            outline: none;
            width: 100%;
            height: 30vh;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fff8dc;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            resize: none;
            line-height: 25px;
        }

        .related-pages-container {
            position: absolute;
            right: -310px;
            top: 0;
            width: 300px;
            background-color: #fff8dc;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            z-index: 20;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        .related-pages-container.show {
            display: block;
        }

        .related-pages-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .related-pages-list button {
            display: block;
            width: 100%;
            text-align: left;
            padding: 8px;
            margin: 0;
            background-color: transparent;
            border: none;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }

        .related-pages-list button:hover {
            background-color: #e8e8c8;
        }

        ::selection {
            background-color: #ffff99;
        }

        .title-input,
        .content-textarea {
            caret-color: #ff6b6b;
            transition: caret-color 0.3s;
        }

        .content-textarea.list-navigation-mode {
            caret-color: blue;
        }

        .page-list-container {
            width: 87%;
            max-width: 623px;
            border: 1px solid transparent;
            padding: 5px 2px 10px 25px;
        }

        .page-list {
            display: block;
            position: static;
            background-color: #fff8dc;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            z-index: 10;
            width: 100%;
        }

        .page-list button {
            text-align: center !important;
            display: block;
            width: 100%;
            text-align: left;
            padding: 8px;
            margin: 5px 0;
            background-color: #fff8dc;
            border: none;
            cursor: pointer;
        }

        .page-list button:hover,
        .page-list button.selected {
            background-color: #e8e8c8;
        }

        .highlight {
            background-color: #ffff99;
            font-weight: bold;
        }

        #file-input {
            display: none;
        }
    </style>
</head>

<body>
    <div class="side-buttons">
        <button class="side-button" id="export-button" title="ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ (Ctrl+S)">â†“</button>
        <button class="side-button" id="import-button" title="ã‚¤ãƒ³ãƒãƒ¼ãƒˆ (Ctrl+O)">â†‘</button>
    </div>

    <div class="input-container">
        <input type="text" id="title-input" class="title-input" placeholder="ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›..." autocomplete="off">
    </div>
    <div class="content-textarea-wrapper">
        <textarea id="content-textarea" class="content-textarea" placeholder="Wikiã®å†…å®¹ã‚’å…¥åŠ›..."></textarea>
        <div class="related-pages-container" id="related-pages-container">
            <div class="related-pages-list" id="related-pages-list"></div>
        </div>
    </div>
    <div class="page-list-container">
        <div class="page-list" id="page-list"></div>
    </div>
    <input type="file" id="file-input" accept=".json">

    <script>
        const LAST_OPENED_KEY = 'last_opened_page';
        let isIMEComposing = false;
        let isMouseOverList = false;
        let selectedIndex = -1;
        let pageButtons = [];
        let currentFilter = '';
        let listNavigationMode = false;
        let listNavigationTimeout = null;

        // ç©ºã®ã‚¨ãƒ³ãƒˆãƒªã‚’å‰Šé™¤
        function cleanEmptyEntries() {
            for (let i = localStorage.length - 1; i >= 0; i--) {
                const key = localStorage.key(i);
                if (key.startsWith('wiki_')) {
                    const content = localStorage.getItem(key);
                    if (!content) {
                        localStorage.removeItem(key);
                        localStorage.removeItem(`wiki_meta_${key.replace('wiki_', '')}`);
                    }
                }
            }
        }

        // ãƒšãƒ¼ã‚¸ä¸€è¦§ã‚’è¡¨ç¤ºï¼ˆçµã‚Šè¾¼ã¿å¯¾å¿œã€çµã‚Šè¾¼ã¿æ™‚ã¯ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã€ãã‚Œä»¥å¤–ã¯æ›´æ–°æ—¥æ™‚é †ï¼‰
        function updatePageList(filter = '') {
            currentFilter = filter;
            const pageList = document.getElementById('page-list');
            pageList.innerHTML = '';
            const pages = [];
            pageButtons = [];

            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('wiki_') && !key.startsWith('wiki_meta_')) {
                    const title = key.replace('wiki_', '');
                    const metaKey = `wiki_meta_${title}`;
                    const meta = JSON.parse(localStorage.getItem(metaKey) || '{"updatedAt": 0}');
                    pages.push({ title, updatedAt: meta.updatedAt });
                }
            }

            // çµã‚Šè¾¼ã¿æ™‚ã¯ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã€ãã‚Œä»¥å¤–ã¯æ›´æ–°æ—¥æ™‚é †
            if (filter) {
                pages.sort((a, b) => a.title.localeCompare(b.title));
            } else {
                pages.sort((a, b) => b.updatedAt - a.updatedAt);
            }

            pages.forEach((page, index) => {
                if (filter && !page.title.includes(filter)) return;

                const button = document.createElement('button');
                if (filter) {
                    const regex = new RegExp(filter, 'gi');
                    button.innerHTML = page.title.replace(regex, match => `<span class="highlight">${match}</span>`);
                } else {
                    button.textContent = page.title;
                }
                button.onclick = () => loadPage(page.title);
                button.onmouseenter = () => loadPage(page.title);
                button.ondblclick = (e) => {
                    e.stopPropagation();
                    if (confirm(`${page.title}ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                        localStorage.removeItem(`wiki_${page.title}`);
                        localStorage.removeItem(`wiki_meta_${page.title}`);
                        if (document.getElementById('title-input').value === page.title) {
                            document.getElementById('title-input').value = '';
                            document.getElementById('content-textarea').value = '';
                        }
                        updatePageList(filter);
                    }
                };
                pageList.appendChild(button);
                pageButtons.push(button);
            });

            // é¸æŠçŠ¶æ…‹ã‚’æ›´æ–°
            if (selectedIndex >= 0 && selectedIndex < pageButtons.length) {
                pageButtons[selectedIndex].classList.add('selected');
            } else {
                selectedIndex = -1;
            }
        }

        // é–¢é€£ãƒšãƒ¼ã‚¸ãƒªã‚¹ãƒˆã‚’æ›´æ–°ï¼ˆåŒæ–¹å‘å¯¾å¿œï¼‰
        function updateRelatedPagesList() {
            const textarea = document.getElementById('content-textarea');
            const container = document.getElementById('related-pages-container');
            const list = document.getElementById('related-pages-list');
            const text = textarea.value;
            const currentTitle = document.getElementById('title-input').value.trim();

            // æ—¢å­˜ã®ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢
            list.innerHTML = '';

            // ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å–å¾—
            const pages = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('wiki_') && !key.startsWith('wiki_meta_')) {
                    const title = key.replace('wiki_', '');
                    const content = localStorage.getItem(key);
                    pages.push({ title, content });
                }
            }

            // åŒæ–¹å‘ã®é–¢é€£æ€§ã‚’ãƒã‚§ãƒƒã‚¯
            const foundTitles = [];
            pages.forEach(page => {
                if (page.title === currentTitle) return;

                // æœ¬æ–‡ã«ã‚¿ã‚¤ãƒˆãƒ«ãŒå«ã¾ã‚Œã‚‹ã‹
                const titleInContent = text.includes(page.title);
                // ã‚¿ã‚¤ãƒˆãƒ«ã«æœ¬æ–‡ãŒå«ã¾ã‚Œã‚‹ã‹
                const contentInTitle = page.content.includes(currentTitle);

                if (titleInContent || contentInTitle) {
                    foundTitles.push(page.title);
                }
            });

            // é–¢é€£ãƒšãƒ¼ã‚¸ãŒã‚ã‚Œã°ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
            if (foundTitles.length > 0) {
                foundTitles.forEach(title => {
                    const button = document.createElement('button');
                    button.textContent = title;
                    button.onclick = () => loadPage(title);
                    list.appendChild(button);
                });
                container.classList.add('show');
            } else {
                container.classList.remove('show');
            }
        }

        // ãƒšãƒ¼ã‚¸ã‚’ä¿å­˜
        function savePage() {
            const title = document.getElementById('title-input').value.trim();
            const content = document.getElementById('content-textarea').value;
            if (title && content.trim() !== '') {
                localStorage.setItem(`wiki_${title}`, content);
                const metaKey = `wiki_meta_${title}`;
                localStorage.setItem(metaKey, JSON.stringify({ updatedAt: Date.now() }));
                localStorage.setItem(LAST_OPENED_KEY, title);
                updatePageList(currentFilter);
                updateRelatedPagesList();
            }
        }

        // ãƒšãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã¿
        function loadPage(title) {
            const content = localStorage.getItem(`wiki_${title}`);
            document.getElementById('title-input').value = title;
            document.getElementById('content-textarea').value = content || '';
            document.getElementById('content-textarea').focus();
            selectedIndex = -1;
            updatePageList(currentFilter);
            updateRelatedPagesList();
        }

        // æ–°è¦ä½œæˆ
        function newPage() {
            document.getElementById('title-input').value = '';
            document.getElementById('content-textarea').value = '';
            document.getElementById('title-input').focus();
            selectedIndex = -1;
            updatePageList('');
            updateRelatedPagesList();
        }

        // textareaã®ã‚«ãƒ¼ã‚½ãƒ«ãŒæœ€çµ‚è¡Œæœ«ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯
        function isCursorAtEnd(textarea) {
            return textarea.selectionStart === textarea.value.length;
        }

        // JSONãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportToJson() {
            const data = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('wiki_') && !key.startsWith('wiki_meta_')) {
                    const title = key.replace('wiki_', '');
                    data[title] = {
                        content: localStorage.getItem(key),
                        meta: JSON.parse(localStorage.getItem(`wiki_meta_${title}`) || '{}')
                    };
                }
            }
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'wiki_export.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // JSONãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        function importFromJson(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const data = JSON.parse(e.target.result);
                    for (const title in data) {
                        localStorage.setItem(`wiki_${title}`, data[title].content);
                        localStorage.setItem(`wiki_meta_${title}`, JSON.stringify(data[title].meta || { updatedAt: Date.now() }));
                    }
                    alert('ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚');
                    updatePageList(currentFilter);
                    updateRelatedPagesList();
                } catch (error) {
                    alert('ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                }
            };
            reader.readAsText(file);
            event.target.value = ''; // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚’ãƒªã‚»ãƒƒãƒˆ
        }

        // inputã®å…¥åŠ›æ™‚ã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å­˜åœ¨ã‚’ãƒã‚§ãƒƒã‚¯
        document.getElementById('title-input').addEventListener('input', function (e) {
            const title = e.target.value.trim();
            if (title) {
                const content = localStorage.getItem(`wiki_${title}`);
                if (content === null) {
                    document.getElementById('content-textarea').value = '';
                } else {
                    document.getElementById('content-textarea').value = content;
                }
            } else {
                document.getElementById('content-textarea').value = '';
            }
            savePage();
            updatePageList(currentFilter);
            updateRelatedPagesList();
        });

        // è‡ªå‹•ä¿å­˜ï¼ˆå†…å®¹ãŒå¤‰æ›´ã•ã‚ŒãŸã‚‰ä¿å­˜ï¼‰
        document.getElementById('content-textarea').addEventListener('input', function () {
            savePage();
            updateRelatedPagesList();
        });

        // IMEå…¥åŠ›ä¸­ã®ãƒ•ãƒ©ã‚°ç®¡ç†
        document.getElementById('title-input').addEventListener('compositionstart', () => {
            isIMEComposing = true;
        });

        document.getElementById('title-input').addEventListener('compositionend', () => {
            isIMEComposing = false;
        });

        // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç§»å‹•æ™‚ã®æ›´æ–°
        document.getElementById('content-textarea').addEventListener('focus', updateRelatedPagesList);
        document.getElementById('title-input').addEventListener('focus', function () {
            this.value = '';
            document.getElementById('content-textarea').value = '';
            updatePageList('');
            updateRelatedPagesList();
        });

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
        document.addEventListener('keydown', function (e) {
            const inputElement = document.getElementById('title-input');
            const textareaElement = document.getElementById('content-textarea');

            // Ctrl+Sã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                exportToJson();
            }
            // Ctrl+Oã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
            else if (e.ctrlKey && e.key === 'o') {
                e.preventDefault();
                document.getElementById('file-input').click();
            }
            // textareaã§ä¸‹ã‚­ãƒ¼ã‚’æŠ¼ã—ãŸæ™‚ã®å‡¦ç†
            else if (document.activeElement === textareaElement && e.key === 'ArrowDown' && isCursorAtEnd(textareaElement)) {
                e.preventDefault();
                if (pageButtons.length === 0) return;

                // ãƒªã‚¹ãƒˆãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¢ãƒ¼ãƒ‰é–‹å§‹
                listNavigationMode = true;
                textareaElement.classList.add('list-navigation-mode');

                // 5ç§’å¾Œã«ãƒ¢ãƒ¼ãƒ‰ã‚’è§£é™¤
                clearTimeout(listNavigationTimeout);
                listNavigationTimeout = setTimeout(() => {
                    listNavigationMode = false;
                    textareaElement.classList.remove('list-navigation-mode');
                }, 5000);

                // é¸æŠè§£é™¤
                if (selectedIndex !== -1) {
                    pageButtons[selectedIndex].classList.remove('selected');
                }

                selectedIndex = selectedIndex === -1 || selectedIndex >= pageButtons.length - 1 ? 0 : selectedIndex + 1;
                pageButtons[selectedIndex].classList.add('selected');
                pageButtons[selectedIndex].scrollIntoView({ block: 'nearest' });

                // é¸æŠã—ãŸãƒšãƒ¼ã‚¸ã®å†…å®¹ã‚’textareaã«åæ˜ 
                const selectedTitle = pageButtons[selectedIndex].textContent;
                const content = localStorage.getItem(`wiki_${selectedTitle}`);
                document.getElementById('title-input').value = selectedTitle;
                document.getElementById('content-textarea').value = content || '';
                updateRelatedPagesList(); // é–¢é€£ãƒšãƒ¼ã‚¸ãƒªã‚¹ãƒˆã‚’æ›´æ–°
            }
            // textareaã§ä¸Šã‚­ãƒ¼ã‚’æŠ¼ã—ãŸæ™‚ã®å‡¦ç†ï¼ˆãƒªã‚¹ãƒˆãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã¿ï¼‰
            else if (document.activeElement === textareaElement && e.key === 'ArrowUp' && listNavigationMode) {
                e.preventDefault();
                if (pageButtons.length === 0) return;

                // é¸æŠè§£é™¤
                if (selectedIndex !== -1) {
                    pageButtons[selectedIndex].classList.remove('selected');
                }

                selectedIndex = selectedIndex <= 0 ? pageButtons.length - 1 : selectedIndex - 1;
                pageButtons[selectedIndex].classList.add('selected');
                pageButtons[selectedIndex].scrollIntoView({ block: 'nearest' });

                // é¸æŠã—ãŸãƒšãƒ¼ã‚¸ã®å†…å®¹ã‚’textareaã«åæ˜ 
                const selectedTitle = pageButtons[selectedIndex].textContent;
                const content = localStorage.getItem(`wiki_${selectedTitle}`);
                document.getElementById('title-input').value = selectedTitle;
                document.getElementById('content-textarea').value = content || '';
                updateRelatedPagesList(); // é–¢é€£ãƒšãƒ¼ã‚¸ãƒªã‚¹ãƒˆã‚’æ›´æ–°
            }
            // IMEå…¥åŠ›ä¸­ã§ãªã„å ´åˆã®ã¿Enterã‚­ãƒ¼ã§textareaã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ï¼ˆtextareaã‚’ç©ºæ¬„ã«ã™ã‚‹ï¼‰
            else if (document.activeElement === inputElement && e.key === 'Enter' && !isIMEComposing) {
                e.preventDefault();
                document.getElementById('content-textarea').value = '';
                document.getElementById('content-textarea').focus();
                updatePageList(currentFilter);
                updateRelatedPagesList();
            }
            // ä¸Šä¸‹ã‚­ãƒ¼ã§ãƒšãƒ¼ã‚¸ãƒªã‚¹ãƒˆã‚’ç§»å‹•
            else if (document.activeElement === inputElement && (e.key === 'ArrowUp' || e.key === 'ArrowDown')) {
                e.preventDefault();
                if (pageButtons.length === 0) return;

                // é¸æŠè§£é™¤
                if (selectedIndex !== -1) {
                    pageButtons[selectedIndex].classList.remove('selected');
                }

                if (e.key === 'ArrowUp') {
                    selectedIndex = selectedIndex <= 0 ? pageButtons.length - 1 : selectedIndex - 1;
                } else if (e.key === 'ArrowDown') {
                    selectedIndex = selectedIndex === -1 || selectedIndex >= pageButtons.length - 1 ? 0 : selectedIndex + 1;
                }

                // é¸æŠé©ç”¨
                if (selectedIndex !== -1) {
                    pageButtons[selectedIndex].classList.add('selected');
                    pageButtons[selectedIndex].scrollIntoView({ block: 'nearest' });
                    // é¸æŠã—ãŸãƒšãƒ¼ã‚¸ã®å†…å®¹ã‚’textareaã«åæ˜ 
                    const selectedTitle = pageButtons[selectedIndex].textContent;
                    const content = localStorage.getItem(`wiki_${selectedTitle}`);
                    document.getElementById('title-input').value = selectedTitle;
                    document.getElementById('content-textarea').value = content || '';
                    updateRelatedPagesList(); // é–¢é€£ãƒšãƒ¼ã‚¸ãƒªã‚¹ãƒˆã‚’æ›´æ–°
                }
            }
            // Tabã‚­ãƒ¼ã§textareaã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
            else if (document.activeElement === inputElement && e.key === 'Tab') {
                e.preventDefault();
                document.getElementById('content-textarea').focus();
            }
            // textareaã§Tabã‚­ãƒ¼ã‚’æŠ¼ã—ãŸã‚‰inputã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ï¼ˆç©ºæ¬„ã«ã—ã€ãƒªã‚¹ãƒˆã‚’æ›´æ–°ï¼‰
            else if (document.activeElement === textareaElement && e.key === 'Tab') {
                e.preventDefault();
                document.getElementById('title-input').value = '';
                document.getElementById('content-textarea').value = '';
                document.getElementById('title-input').focus();
                updatePageList('');
                updateRelatedPagesList();
            }
        });

        // inputã®çµã‚Šè¾¼ã¿æ©Ÿèƒ½
        document.getElementById('title-input').addEventListener('input', function (e) {
            if (!isMouseOverList) {
                updatePageList(e.target.value);
            }
        });

        // ãƒšãƒ¼ã‚¸ãƒªã‚¹ãƒˆã«ãƒã‚¦ã‚¹ãŒä¹—ã£ãŸ/é›¢ã‚ŒãŸæ™‚ã®å‡¦ç†
        document.getElementById('page-list').addEventListener('mouseenter', () => {
            isMouseOverList = true;
        });
        document.getElementById('page-list').addEventListener('mouseleave', () => {
            isMouseOverList = false;
            updatePageList(document.getElementById('title-input').value);
            updateRelatedPagesList();
        });

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById('file-input').addEventListener('change', importFromJson);

        // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById('export-button').addEventListener('click', exportToJson);

        // ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById('import-button').addEventListener('click', () => {
            document.getElementById('file-input').click();
        });

        // åˆæœŸè¡¨ç¤º
        window.addEventListener('load', function () {
            cleanEmptyEntries();
            const lastOpenedTitle = localStorage.getItem(LAST_OPENED_KEY);
            if (lastOpenedTitle) {
                loadPage(lastOpenedTitle);
            } else {
                document.getElementById('title-input').focus();
            }
            updatePageList();
            updateRelatedPagesList();
        });
    </script>
</body>

</html>